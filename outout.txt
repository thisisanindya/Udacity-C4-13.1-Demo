project student$ python test.py
Loading openai_api_key... 
Checking OPENAI_API_KEY =  voc-1480983305158766391158168f3b972425940.77376623
Initializing Database...
/workspace/agentic-ai-c4-exercises-demos/project/test.py:1423: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  quote_requests_sample["request_date"] = pd.to_datetime(
---> Function (generate_financial_report): Get financial report as of '2025-04-01'
---> Function (get_cash_balance): Get cash balance as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Paper plates' as of '2025-04-01'
---> Function (get_stock_level): Get stock for '100 lb cover stock' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Glossy paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Rolls of banner paper (36-inch width)' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Photo paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Cardstock' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Colored paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for '80 lb text paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Large poster paper (24x36 inches)' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Table covers' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Butcher paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Kraft paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Banner paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Presentation folders' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Patterned paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'A4 paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Invitation cards' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Crepe paper' as of '2025-04-01'

<--- Request 1 --->
Context: office manager organizing ceremony
Request Date: 2025-04-01
Cash Balance: $45059.70
Inventory Value: $4940.30
---> Orchestration Agent classified request as: ORDER
---> Function (get_stock_level): Get stock for 'A4 glossy paper' as of '2025-04-01'
---> Function (get_supplier_delivery_date): Get estimated delivery date in as of '2025-04-01'
---> Check for quantity =  200
---> medium quantity
---> discounted price =  180.0
---> Function (get_stock_level): Get stock for 'heavy cardstock (white)' as of '2025-04-01'
---> Function (get_supplier_delivery_date): Get estimated delivery date in as of '2025-04-01'
---> Check for quantity =  100
---> medium quantity
---> discounted price =  90.0
---> Function (get_stock_level): Get stock for 'colored paper (assorted colors)' as of '2025-04-01'
---> Function (get_supplier_delivery_date): Get estimated delivery date in as of '2025-04-01'
---> Check for quantity =  100
---> medium quantity
---> discounted price =  45.0
Traceback (most recent call last):
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/models/openai.py", line 629, in _process_response
    response = self._validate_completion(response)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/models/openai.py", line 598, in _validate_completion
    return chat.ChatCompletion.model_validate(response.model_dump())
  File "/opt/venv/lib/python3.10/site-packages/pydantic/main.py", line 716, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 4 validation errors for ChatCompletion
id
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
choices
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/list_type
model
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
object
  Input should be 'chat.completion' [type=literal_error, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/literal_error

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/agentic-ai-c4-exercises-demos/project/test.py", line 1504, in <module>
    results = run_test_scenarios()
  File "/workspace/agentic-ai-c4-exercises-demos/project/test.py", line 1464, in run_test_scenarios
    response = multi_agent_workflow.run(request_with_date)
  File "/workspace/agentic-ai-c4-exercises-demos/project/test.py", line 1395, in run
    response = self.process_order(context)
  File "/workspace/agentic-ai-c4-exercises-demos/project/test.py", line 1317, in process_order
    quoting_response = self.agents["quoting"].run_sync(
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/agent/abstract.py", line 347, in run_sync
    return _utils.get_event_loop().run_until_complete(
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
    return future.result()
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/agent/abstract.py", line 226, in run
    async with self.iter(
  File "/usr/local/lib/python3.10/contextlib.py", line 217, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/agent/__init__.py", line 658, in iter
    async with graph.iter(
  File "/usr/local/lib/python3.10/contextlib.py", line 217, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
  File "/usr/local/lib/python3.10/contextlib.py", line 714, in __aexit__
    raise exc_details[1]
  File "/usr/local/lib/python3.10/contextlib.py", line 695, in __aexit__
    cb_suppress = cb(*exc_details)
  File "/usr/local/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/_agent_graph.py", line 445, in run
    return await self._make_request(ctx)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/_agent_graph.py", line 487, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/models/openai.py", line 479, in request
    model_response = self._process_response(response)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/models/openai.py", line 631, in _process_response
    raise UnexpectedModelBehavior(f'Invalid response from {self.system} chat completions endpoint: {e}') from e
pydantic_ai.exceptions.UnexpectedModelBehavior: Invalid response from openai chat completions endpoint: 4 validation errors for ChatCompletion
id
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
choices
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/list_type
model
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
object
  Input should be 'chat.completion' [type=literal_error, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/literal_error
project student$ 