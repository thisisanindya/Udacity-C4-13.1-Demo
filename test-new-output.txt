project student$ python test-new.py
Loading openai_api_key... 
Checking OPENAI_API_KEY =  voc-822346846168865391158168c5c2a6e896b0.00021708
Initializing Database...
---> Function (generate_financial_report): Get financial report as of '2025-04-01'
---> Function (get_cash_balance): Get cash balance as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Paper plates' as of '2025-04-01'
---> Function (get_stock_level): Get stock for '100 lb cover stock' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Glossy paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Rolls of banner paper (36-inch width)' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Photo paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Cardstock' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Colored paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for '80 lb text paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Large poster paper (24x36 inches)' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Table covers' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Butcher paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Kraft paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Banner paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Presentation folders' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Patterned paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'A4 paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Invitation cards' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Crepe paper' as of '2025-04-01'

<--- Request 1 --->
Context: office manager organizing ceremony
Request Date: 2025-04-01
Cash Balance: $45059.70
Inventory Value: $4940.30
CHECKPOINT-0.0 --->  I would like to request the following paper supplies for the ceremony: 

- 200 sheets of A4 glossy paper
- 100 sheets of heavy cardstock (white)
- 100 sheets of colored paper (assorted colors)

I need these supplies delivered by April 15, 2025. Thank you. (Date of request: 2025-04-01)
CHECKPOINT-0.1 ---> context -  request_id='REQ_20251215193951' original_request='I would like to request the following paper supplies for the ceremony: \n\n- 200 sheets of A4 glossy paper\n- 100 sheets of heavy cardstock (white)\n- 100 sheets of colored paper (assorted colors)\n\nI need these supplies delivered by April 15, 2025. Thank you. (Date of request: 2025-04-01)'
CHECKPOINT-0.2 ---> Orchestration Agent classified request as: ORDER

CHECKING Inventory Agent ===>  Agent(model=OpenAIChatModel(), name='InventoryAgent', end_strategy='early', model_settings={'temperature': 0.0, 'max_retries': 3}, output_type=<class '__main__.InventoryAgentResponse'>, instrument=None)

CHECKING Iventory Agent - prompt ===>  
            Classification: ORDER
            Items: ['Cardstock', 'Colored paper', 'Glossy paper']
            User Request: I would like to request the following paper supplies for the ceremony: 

- 200 sheets of A4 glossy paper
- 100 sheets of heavy cardstock (white)
- 100 sheets of colored paper (assorted colors)

I need these supplies delivered by April 15, 2025. Thank you. (Date of request: 2025-04-01)
        

---> Function (get_stock_level): Get stock for 'Glossy paper' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Cardstock' as of '2025-04-01'
---> Function (get_stock_level): Get stock for 'Colored paper' as of '2025-04-01'
>>>>>>>>>> inventory_response.answer =  Your order for 200 sheets of A4 glossy paper, 100 sheets of heavy cardstock (white), and 100 sheets of colored paper (assorted colors) can be fulfilled now as we have sufficient stock for all items. Thank you for your request!
>>>>>>>>>> inventory_response.ok_to_proceed =  True

CHECKING Quote Agent ===>  Agent(model=OpenAIChatModel(), name='QuotingAgent', end_strategy='early', model_settings={'temperature': 0.0, 'max_retries': 3}, output_type=<class '__main__.QuotingAgentResponse'>, instrument=None)

CHECKING Quote Agent - prompt ===>  
            Classification: ORDER
            User Request: I would like to request the following paper supplies for the ceremony: 

- 200 sheets of A4 glossy paper
- 100 sheets of heavy cardstock (white)
- 100 sheets of colored paper (assorted colors)

I need these supplies delivered by April 15, 2025. Thank you. (Date of request: 2025-04-01)
            Inventory Context: Your order for 200 sheets of A4 glossy paper, 100 sheets of heavy cardstock (white), and 100 sheets of colored paper (assorted colors) can be fulfilled now as we have sufficient stock for all items. Thank you for your request! 
        

⚠️ Quoting agent failed, retrying once...
Traceback (most recent call last):
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/models/openai.py", line 629, in _process_response
    response = self._validate_completion(response)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/models/openai.py", line 598, in _validate_completion
    return chat.ChatCompletion.model_validate(response.model_dump())
  File "/opt/venv/lib/python3.10/site-packages/pydantic/main.py", line 716, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 4 validation errors for ChatCompletion
id
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
choices
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/list_type
model
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
object
  Input should be 'chat.completion' [type=literal_error, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/literal_error

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/agentic-ai-c4-exercises-demos/project/test-new.py", line 1552, in <module>
    results = run_test_scenarios()
  File "/workspace/agentic-ai-c4-exercises-demos/project/test-new.py", line 1506, in run_test_scenarios
    response = multi_agent_workflow.run(request_with_date)
  File "/workspace/agentic-ai-c4-exercises-demos/project/test-new.py", line 1431, in run
    response = self.process_order(context)
  File "/workspace/agentic-ai-c4-exercises-demos/project/test-new.py", line 1325, in process_order
    quoting_response = self.agents["quoting"].run_sync(
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/agent/abstract.py", line 372, in run_sync
    return _utils.get_event_loop().run_until_complete(
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
    return future.result()
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/agent/abstract.py", line 251, in run
    async with self.iter(
  File "/usr/local/lib/python3.10/contextlib.py", line 217, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/agent/__init__.py", line 673, in iter
    async with graph.iter(
  File "/usr/local/lib/python3.10/contextlib.py", line 217, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
  File "/usr/local/lib/python3.10/contextlib.py", line 714, in __aexit__
    raise exc_details[1]
  File "/usr/local/lib/python3.10/contextlib.py", line 695, in __aexit__
    cb_suppress = cb(*exc_details)
  File "/usr/local/lib/python3.10/contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/_agent_graph.py", line 440, in run
    return await self._make_request(ctx)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/_agent_graph.py", line 482, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/models/openai.py", line 477, in request
    model_response = self._process_response(response)
  File "/opt/venv/lib/python3.10/site-packages/pydantic_ai/models/openai.py", line 631, in _process_response
    raise UnexpectedModelBehavior(f'Invalid response from {self.system} chat completions endpoint: {e}') from e
pydantic_ai.exceptions.UnexpectedModelBehavior: Invalid response from openai chat completions endpoint: 4 validation errors for ChatCompletion
id
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
choices
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/list_type
model
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
object
  Input should be 'chat.completion' [type=literal_error, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.12/v/literal_error
project student$ ^C
project student$ ^C
project student$ 